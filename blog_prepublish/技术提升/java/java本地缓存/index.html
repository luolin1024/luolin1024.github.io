<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Javaæœ¬åœ°ç¼“å­˜ | luolin1024</title><meta name=keywords content="Java/æœ¬åœ°ç¼“å­˜,ç¼“å­˜"><meta name=description content="å‰è¨€ å¯¹ä¸€ä¸ªjavaåå°å¼€å‘è€…è€Œè¨€ï¼Œæåˆ°ç¼“å­˜ï¼Œç¬¬ä¸€ååº”å°±æ˜¯rediså’Œmemcacheã€‚åˆ©ç”¨è¿™ç±»ç¼“å­˜è¶³ä»¥è§£å†³å¤§å¤šæ•°çš„æ€§èƒ½é—®é¢˜äº†ï¼Œå¹¶ä¸”javaé’ˆ"><meta name=author content="luolin"><link rel=canonical href=https://luolin1024.github.io/blog_prepublish/%E6%8A%80%E6%9C%AF%E6%8F%90%E5%8D%87/java/java%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98/><script defer src=https://blogcounter.luolin.us.kg/script.js data-website-id=c8850e2c-16aa-465e-aa6f-5392c9397317></script>
<script src=/js/umami-stats.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script>
<link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://luolin1024.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://luolin1024.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://luolin1024.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://luolin1024.github.io/apple-touch-icon.png><link rel=mask-icon href=https://luolin1024.github.io/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><html><head><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/style.css><style>body{font-family:lxgw wenkai lite,sans-serif;font-family:lxgw wenkai screen,sans-serif}</style></head></html><meta property="og:title" content="Javaæœ¬åœ°ç¼“å­˜"><meta property="og:description" content="å‰è¨€ å¯¹ä¸€ä¸ªjavaåå°å¼€å‘è€…è€Œè¨€ï¼Œæåˆ°ç¼“å­˜ï¼Œç¬¬ä¸€ååº”å°±æ˜¯rediså’Œmemcacheã€‚åˆ©ç”¨è¿™ç±»ç¼“å­˜è¶³ä»¥è§£å†³å¤§å¤šæ•°çš„æ€§èƒ½é—®é¢˜äº†ï¼Œå¹¶ä¸”javaé’ˆ"><meta property="og:type" content="article"><meta property="og:url" content="https://luolin1024.github.io/blog_prepublish/%E6%8A%80%E6%9C%AF%E6%8F%90%E5%8D%87/java/java%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98/"><meta property="article:section" content="blog_prepublish"><meta property="article:published_time" content="2023-02-11T00:32:19+08:00"><meta property="article:modified_time" content="2024-03-21T00:56:58+08:00"><meta property="og:site_name" content="luolinçš„åšå®¢"><meta name=twitter:card content="summary"><meta name=twitter:title content="Javaæœ¬åœ°ç¼“å­˜"><meta name=twitter:description content="å‰è¨€ å¯¹ä¸€ä¸ªjavaåå°å¼€å‘è€…è€Œè¨€ï¼Œæåˆ°ç¼“å­˜ï¼Œç¬¬ä¸€ååº”å°±æ˜¯rediså’Œmemcacheã€‚åˆ©ç”¨è¿™ç±»ç¼“å­˜è¶³ä»¥è§£å†³å¤§å¤šæ•°çš„æ€§èƒ½é—®é¢˜äº†ï¼Œå¹¶ä¸”javaé’ˆ"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog_prepublishes","item":"https://luolin1024.github.io/blog_prepublish/"},{"@type":"ListItem","position":2,"name":"Javaæœ¬åœ°ç¼“å­˜","item":"https://luolin1024.github.io/blog_prepublish/%E6%8A%80%E6%9C%AF%E6%8F%90%E5%8D%87/java/java%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Javaæœ¬åœ°ç¼“å­˜","name":"Javaæœ¬åœ°ç¼“å­˜","description":"å‰è¨€ å¯¹ä¸€ä¸ªjavaåå°å¼€å‘è€…è€Œè¨€ï¼Œæåˆ°ç¼“å­˜ï¼Œç¬¬ä¸€ååº”å°±æ˜¯rediså’Œmemcacheã€‚åˆ©ç”¨è¿™ç±»ç¼“å­˜è¶³ä»¥è§£å†³å¤§å¤šæ•°çš„æ€§èƒ½é—®é¢˜äº†ï¼Œå¹¶ä¸”javaé’ˆ","keywords":["Java/æœ¬åœ°ç¼“å­˜","ç¼“å­˜"],"articleBody":"å‰è¨€ å¯¹ä¸€ä¸ªjavaåå°å¼€å‘è€…è€Œè¨€ï¼Œæåˆ°ç¼“å­˜ï¼Œç¬¬ä¸€ååº”å°±æ˜¯rediså’Œmemcacheã€‚åˆ©ç”¨è¿™ç±»ç¼“å­˜è¶³ä»¥è§£å†³å¤§å¤šæ•°çš„æ€§èƒ½é—®é¢˜äº†ï¼Œå¹¶ä¸”javaé’ˆå¯¹è¿™ä¸¤è€…ä¹Ÿéƒ½æœ‰éå¸¸æˆç†Ÿçš„apiå¯ä¾›ä½¿ç”¨ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿè¦çŸ¥é“ï¼Œè¿™ä¸¤ç§éƒ½å±äºremote cacheï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰ï¼Œåº”ç”¨çš„è¿›ç¨‹å’Œç¼“å­˜çš„è¿›ç¨‹é€šå¸¸åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä¸åŒè¿›ç¨‹ä¹‹é—´é€šè¿‡RPCæˆ–HTTPçš„æ–¹å¼é€šä¿¡ã€‚è¿™ç§ç¼“å­˜çš„ä¼˜ç‚¹æ˜¯ç¼“å­˜å’Œåº”ç”¨æœåŠ¡è§£è€¦ï¼Œæ”¯æŒå¤§æ•°æ®é‡çš„å­˜å‚¨ï¼Œç¼ºç‚¹æ˜¯æ•°æ®è¦ç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œæ€§èƒ½ä¸Šä¼šæœ‰ä¸€å®šæŸè€—ã€‚ä¸åˆ†å¸ƒå¼ç¼“å­˜å¯¹åº”çš„æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œç¼“å­˜çš„è¿›ç¨‹å’Œåº”ç”¨è¿›ç¨‹æ˜¯åŒä¸€ä¸ªï¼Œæ•°æ®çš„è¯»å†™éƒ½åœ¨ä¸€ä¸ªè¿›ç¨‹å†…å®Œæˆï¼Œè¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯æ²¡æœ‰ç½‘ç»œå¼€é”€ï¼Œè®¿é—®é€Ÿåº¦å¾ˆå¿«ã€‚ç¼ºç‚¹æ˜¯å—JVMå†…å­˜çš„é™åˆ¶ï¼Œä¸é€‚åˆå­˜æ”¾å¤§æ•°æ®ã€‚æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬ä¸»è¦ä¸»è¦è®¨è®ºJavaæœ¬åœ°ç¼“å­˜çš„çš„ä¸€äº›å¸¸ç”¨æ–¹æ¡ˆã€‚\næœ¬åœ°ç¼“å­˜å¸¸ç”¨æŠ€æœ¯ æœ¬åœ°ç¼“å­˜å’Œåº”ç”¨åŒå±äºä¸€ä¸ªè¿›ç¨‹ï¼Œä½¿ç”¨ä¸å½“ä¼šå½±å“æœåŠ¡ç¨³å®šæ€§ï¼Œæ‰€ä»¥é€šå¸¸éœ€è¦è€ƒè™‘æ›´å¤šçš„å› ç´ ï¼Œä¾‹å¦‚å®¹é‡é™åˆ¶ã€è¿‡æœŸç­–ç•¥ã€æ·˜æ±°ç­–ç•¥ã€è‡ªåŠ¨åˆ·æ–°ç­‰ã€‚å¸¸ç”¨çš„æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆæœ‰ï¼š\næ ¹æ®HashMapè‡ªå®ç°æœ¬åœ°ç¼“å­˜ Guava Cache Caffeine Encache æ€»ä½“æ¥è¯´ï¼Œå¯¹äºæœ¬åœ°ç¼“å­˜çš„æ–¹æ¡ˆä¸­ï¼Œç¬”è€…æ¯”è¾ƒæ¨èCaffeineï¼Œæ€§èƒ½ä¸Šé¥é¥é¢†å…ˆã€‚è™½ç„¶EncacheåŠŸèƒ½æ›´ä¸ºä¸°å¯Œï¼Œç”šè‡³æä¾›äº†æŒä¹…åŒ–å’Œé›†ç¾¤çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™äº›åŠŸèƒ½å®Œå…¨å¯ä»¥ä¾é å…¶ä»–æ–¹å¼å®ç°ã€‚çœŸå®çš„ä¸šåŠ¡å·¥ç¨‹ä¸­ï¼Œå»ºè®®ä½¿ç”¨Caffeineä½œä¸ºæœ¬åœ°ç¼“å­˜ï¼Œå¦å¤–ä½¿ç”¨redisæˆ–è€…memcacheä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜ï¼Œæ„é€ å¤šçº§ç¼“å­˜ä½“ç³»ï¼Œä¿è¯æ€§èƒ½å’Œå¯é æ€§ã€‚ä¸‹é¢åˆ†åˆ«è¿›è¡Œä»‹ç»ï¼š\n1. æ ¹æ®HashMapè‡ªå®šä¹‰å®ç°æœ¬åœ°ç¼“å­˜ ç¼“å­˜çš„æœ¬è´¨å°±æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„KVæ•°æ®ç»“æ„ï¼Œå¯¹åº”çš„å°±æ˜¯jdkä¸­çš„HashMapï¼Œä½†æ˜¯è¦å®ç°ç¼“å­˜ï¼Œè¿˜éœ€è¦è€ƒè™‘å¹¶å‘å®‰å…¨æ€§ã€å®¹é‡é™åˆ¶ç­‰ç­–ç•¥ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ç§åˆ©ç”¨LinkedHashMapå®ç°ç¼“å­˜çš„æ–¹å¼ï¼š\npublic class LRUCache extends LinkedHashMap { /** * å¯é‡å…¥è¯»å†™é”ï¼Œä¿è¯å¹¶å‘è¯»å†™å®‰å…¨æ€§ */ private ReentrantReadWriteLock readWriteLock = new ReentrantReadWriteLock(); private Lock readLock = readWriteLock.readLock(); private Lock writeLock = readWriteLock.writeLock(); /** * ç¼“å­˜å¤§å°é™åˆ¶ */ private int maxSize; public LRUCache(int maxSize) { super(maxSize + 1, 1.0f, true); this.maxSize = maxSize; } @Override public Object get(Object key) { readLock.lock(); try { return super.get(key); } finally { readLock.unlock(); } } @Override public Object put(Object key, Object value) { writeLock.lock(); try { return super.put(key, value); } finally { writeLock.unlock(); } } @Override protected boolean removeEldestEntry(Map.Entry eldest) { return this.size() \u003e maxSize; } } å¤åˆ¶ä»£ç LinkedHashMapç»´æŒäº†ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œç”¨æ¥å­˜å‚¨èŠ‚ç‚¹çš„æ’å…¥é¡ºåºæˆ–è€…è®¿é—®é¡ºåºï¼ˆäºŒé€‰ä¸€ï¼‰ï¼Œå¹¶ä¸”å†…éƒ¨å°è£…äº†ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œåªéœ€è¦è¦†ç›–removeEldestEntryæ–¹æ³•ï¼Œä¾¿å¯ä»¥å®ç°ç¼“å­˜çš„LRUæ·˜æ±°ç­–ç•¥ã€‚æ­¤å¤–æˆ‘ä»¬åˆ©ç”¨è¯»å†™é”ï¼Œä¿éšœç¼“å­˜çš„å¹¶å‘å®‰å…¨æ€§ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç¤ºä¾‹å¹¶ä¸æ”¯æŒè¿‡æœŸæ—¶é—´æ·˜æ±°çš„ç­–ç•¥ã€‚è‡ªå®ç°ç¼“å­˜çš„æ–¹å¼ï¼Œä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œä¸éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…ï¼Œæ¯”è¾ƒé€‚åˆä¸€äº›ç®€å•çš„ä¸šåŠ¡åœºæ™¯ã€‚ç¼ºç‚¹æ˜¯å¦‚æœéœ€è¦æ›´å¤šçš„ç‰¹æ€§ï¼Œéœ€è¦å®šåˆ¶åŒ–å¼€å‘ï¼Œæˆæœ¬ä¼šæ¯”è¾ƒé«˜ï¼Œå¹¶ä¸”ç¨³å®šæ€§å’Œå¯é æ€§ä¹Ÿéš¾ä»¥ä¿éšœã€‚å¯¹äºæ¯”è¾ƒå¤æ‚çš„åœºæ™¯ï¼Œå»ºè®®ä½¿ç”¨æ¯”è¾ƒç¨³å®šçš„å¼€æºå·¥å…·ã€‚\n2. åŸºäºGuava Cacheå®ç°æœ¬åœ°ç¼“å­˜ Guavaæ˜¯Googleå›¢é˜Ÿå¼€æºçš„ä¸€æ¬¾ Java æ ¸å¿ƒå¢å¼ºåº“ï¼ŒåŒ…å«é›†åˆã€å¹¶å‘åŸè¯­ã€ç¼“å­˜ã€IOã€åå°„ç­‰å·¥å…·ç®±ï¼Œæ€§èƒ½å’Œç¨³å®šæ€§ä¸Šéƒ½æœ‰ä¿éšœï¼Œåº”ç”¨ååˆ†å¹¿æ³›ã€‚Guava Cacheæ”¯æŒå¾ˆå¤šç‰¹æ€§ï¼š\næ”¯æŒæœ€å¤§å®¹é‡é™åˆ¶ æ”¯æŒä¸¤ç§è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼ˆæ’å…¥æ—¶é—´å’Œè®¿é—®æ—¶é—´ï¼‰ æ”¯æŒç®€å•çš„ç»Ÿè®¡åŠŸèƒ½ åŸºäºLRUç®—æ³•å®ç° Guava Cacheçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥mavenåŒ…ï¼š com.google.guava guava 18.0 å¤åˆ¶ä»£ç ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼špublic class GuavaCacheTest { public static void main(String[] args) throws Exception { //åˆ›å»ºguava cache Cache loadingCache = CacheBuilder.newBuilder() //cacheçš„åˆå§‹å®¹é‡ .initialCapacity(5) //cacheæœ€å¤§ç¼“å­˜æ•° .maximumSize(10) //è®¾ç½®å†™ç¼“å­˜ånç§’é’Ÿè¿‡æœŸ .expireAfterWrite(17, TimeUnit.SECONDS) //è®¾ç½®è¯»å†™ç¼“å­˜ånç§’é’Ÿè¿‡æœŸ,å®é™…å¾ˆå°‘ç”¨åˆ°,ç±»ä¼¼äºexpireAfterWrite //.expireAfterAccess(17, TimeUnit.SECONDS) .build(); String key = â€œkeyâ€; // å¾€ç¼“å­˜å†™æ•°æ® loadingCache.put(key, â€œvâ€); // è·å–valueçš„å€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œè°ƒç”¨collableæ–¹æ³•è·å–valueå€¼åŠ è½½åˆ°keyä¸­å†è¿”å› String value = loadingCache.get(key, new Callable() { @Override public String call() throws Exception { return getValueFromDB(key); } }); // åˆ é™¤key loadingCache.invalidate(key); } private static String getValueFromDB(String key) { return â€œvâ€; } } å¤åˆ¶ä»£ç æ€»ä½“æ¥è¯´ï¼ŒGuava Cacheæ˜¯ä¸€æ¬¾ååˆ†ä¼˜å¼‚çš„ç¼“å­˜å·¥å…·ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œçº¿ç¨‹å®‰å…¨ï¼Œè¶³ä»¥æ»¡è¶³å·¥ç¨‹åŒ–ä½¿ç”¨ï¼Œä»¥ä¸Šä»£ç åªä»‹ç»äº†ä¸€èˆ¬çš„ç”¨æ³•ï¼Œå®é™…ä¸Šspringbootå¯¹guavaä¹Ÿæœ‰æ”¯æŒï¼Œåˆ©ç”¨é…ç½®æ–‡ä»¶æˆ–è€…æ³¨è§£å¯ä»¥è½»æ¾é›†æˆåˆ°ä»£ç ä¸­ã€‚\n3. Caffeine Caffeineæ˜¯åŸºäºjava8å®ç°çš„æ–°ä¸€ä»£ç¼“å­˜å·¥å…·ï¼Œç¼“å­˜æ€§èƒ½æ¥è¿‘ç†è®ºæœ€ä¼˜ã€‚å¯ä»¥çœ‹ä½œæ˜¯Guava Cacheçš„å¢å¼ºç‰ˆï¼ŒåŠŸèƒ½ä¸Šä¸¤è€…ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯Caffeineé‡‡ç”¨äº†ä¸€ç§ç»“åˆLRUã€LFUä¼˜ç‚¹çš„ç®—æ³•ï¼šW-TinyLFUï¼Œåœ¨æ€§èƒ½ä¸Šæœ‰æ˜æ˜¾çš„ä¼˜è¶Šæ€§ã€‚Caffeineçš„ä½¿ç”¨ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥mavenåŒ…ï¼š com.github.ben-manes.caffeine caffeine 2.5.5 å¤åˆ¶ä»£ç ä½¿ç”¨ä¸Šå’ŒGuava CacheåŸºæœ¬ç±»ä¼¼ï¼špublic class CaffeineCacheTest { public static void main(String[] args) throws Exception { //åˆ›å»ºguava cache Cache loadingCache = Caffeine.newBuilder() //cacheçš„åˆå§‹å®¹é‡ .initialCapacity(5) //cacheæœ€å¤§ç¼“å­˜æ•° .maximumSize(10) //è®¾ç½®å†™ç¼“å­˜ånç§’é’Ÿè¿‡æœŸ .expireAfterWrite(17, TimeUnit.SECONDS) //è®¾ç½®è¯»å†™ç¼“å­˜ånç§’é’Ÿè¿‡æœŸ,å®é™…å¾ˆå°‘ç”¨åˆ°,ç±»ä¼¼äºexpireAfterWrite //.expireAfterAccess(17, TimeUnit.SECONDS) .build(); String key = â€œkeyâ€; // å¾€ç¼“å­˜å†™æ•°æ® loadingCache.put(key, â€œvâ€); // è·å–valueçš„å€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œè·å–valueåå†è¿”å› String value = loadingCache.get(key, CaffeineCacheTest::getValueFromDB); // åˆ é™¤key loadingCache.invalidate(key); } private static String getValueFromDB(String key) { return â€œvâ€; } } å¤åˆ¶ä»£ç ç›¸æ¯”Guava Cacheæ¥è¯´ï¼ŒCaffeineæ— è®ºä»åŠŸèƒ½ä¸Šå’Œæ€§èƒ½ä¸Šéƒ½æœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚åŒæ—¶ä¸¤è€…çš„APIç±»ä¼¼ï¼Œä½¿ç”¨Guava Cacheçš„ä»£ç å¾ˆå®¹æ˜“å¯ä»¥åˆ‡æ¢åˆ°Caffeineï¼ŒèŠ‚çœè¿ç§»æˆæœ¬ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSpringFramework5.0ï¼ˆSpringBoot2.0ï¼‰åŒæ ·æ”¾å¼ƒäº†Guava Cacheçš„æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆï¼Œè½¬è€Œä½¿ç”¨Caffeineã€‚\n4. Encache Encacheæ˜¯ä¸€ä¸ªçº¯Javaçš„è¿›ç¨‹å†…ç¼“å­˜æ¡†æ¶ï¼Œå…·æœ‰å¿«é€Ÿã€ç²¾å¹²ç­‰ç‰¹ç‚¹ï¼Œæ˜¯Hibernateä¸­é»˜è®¤çš„CacheProviderã€‚åŒCaffeineå’ŒGuava Cacheç›¸æ¯”ï¼ŒEncacheçš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œæ‰©å±•æ€§æ›´å¼ºï¼š\næ”¯æŒå¤šç§ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼ŒåŒ…æ‹¬LRUã€LFUå’ŒFIFO ç¼“å­˜æ”¯æŒå †å†…å­˜å‚¨ã€å †å¤–å­˜å‚¨ã€ç£ç›˜å­˜å‚¨ï¼ˆæ”¯æŒæŒä¹…åŒ–ï¼‰ä¸‰ç§ æ”¯æŒå¤šç§é›†ç¾¤æ–¹æ¡ˆï¼Œè§£å†³æ•°æ®å…±äº«é—®é¢˜ Encacheçš„ä½¿ç”¨ï¼Œé¦–å…ˆéœ€è¦å¯¼å…¥mavenåŒ…ï¼š org.ehcache ehcache 3.8.0 å¤åˆ¶ä»£ç ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ¡ˆä¾‹ï¼špublic class EncacheTest { public static void main(String[] args) throws Exception { // å£°æ˜ä¸€ä¸ªcacheBuilder CacheManager cacheManager = CacheManagerBuilder.newCacheManagerBuilder() .withCache(â€œencacheInstanceâ€, CacheConfigurationBuilder //å£°æ˜ä¸€ä¸ªå®¹é‡ä¸º20çš„å †å†…ç¼“å­˜ .newCacheConfigurationBuilder(String.class,String.class, ResourcePoolsBuilder.heap(20))) .build(true); // è·å–Cacheå®ä¾‹ Cache myCache = cacheManager.getCache(â€œencacheInstanceâ€, String.class, String.class); // å†™ç¼“å­˜ myCache.put(â€œkeyâ€,â€œvâ€); // è¯»ç¼“å­˜ String value = myCache.get(â€œkeyâ€); // ç§»é™¤æ¢ç²— cacheManager.removeCache(â€œmyCacheâ€); cacheManager.close(); } } å¤åˆ¶ä»£ç \næ€»ç»“ ä»æ˜“ç”¨æ€§è§’åº¦ï¼ŒGuava Cacheã€Caffeineå’ŒEncacheéƒ½æœ‰ååˆ†æˆç†Ÿçš„æ¥å…¥æ–¹æ¡ˆï¼Œä½¿ç”¨ç®€å•ã€‚ ä»åŠŸèƒ½æ€§è§’åº¦ï¼ŒGuava Cacheå’ŒCaffeineåŠŸèƒ½ç±»ä¼¼ï¼Œéƒ½æ˜¯åªæ”¯æŒå †å†…ç¼“å­˜ï¼ŒEncacheç›¸æ¯”åŠŸèƒ½æ›´ä¸ºä¸°å¯Œ ä»æ€§èƒ½ä¸Šè¿›è¡Œæ¯”è¾ƒï¼ŒCaffeineæœ€ä¼˜ã€GuavaCacheæ¬¡ä¹‹ï¼ŒEncacheæœ€å·®(ä¸‹å›¾æ˜¯ä¸‰è€…çš„æ€§èƒ½å¯¹æ¯”ç»“æœï¼‰ ","wordCount":"2643","inLanguage":"en","datePublished":"2023-02-11T00:32:19+08:00","dateModified":"2024-03-21T00:56:58+08:00","author":{"@type":"Person","name":"luolin"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://luolin1024.github.io/blog_prepublish/%E6%8A%80%E6%9C%AF%E6%8F%90%E5%8D%87/java/java%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98/"},"publisher":{"@type":"Organization","name":"luolin1024","logo":{"@type":"ImageObject","url":"https://luolin1024.github.io/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://luolin1024.github.io accesskey=h title="luolinçš„åšå®¢ (Alt + H)">luolinçš„åšå®¢</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://luolin1024.github.io/posts title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://luolin1024.github.io/archives/ title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://luolin1024.github.io/search/ title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://luolin1024.github.io/tags title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://luolin1024.github.io/about title=ğŸ™‹ğŸ»â€â™‚ï¸å…³äº><span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span></a></li><li><a href=https://luolin1024.github.io/links title=ğŸ¤å‹é“¾><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://luolin1024.github.io>Home</a>&nbsp;Â»&nbsp;<a href=https://luolin1024.github.io/blog_prepublish/>Blog_prepublishes</a></div><h1 class="post-title entry-hint-parent">Javaæœ¬åœ°ç¼“å­˜</h1><div class=post-meta><span title='2023-02-11 00:32:19 +0800 +0800'>2023-02-11</span>&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;2643 words&nbsp;Â·&nbsp;luolin
æœ¬æ–‡æ€»é˜…è¯»é‡ <span id=umami_value_page_pv></span> æ¬¡
æœ¬æ–‡æ€»è®¿å®¢é‡ <span id=umami_value_page_uv></span> äºº</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#%e6%9c%ac%e5%9c%b0%e7%bc%93%e5%ad%98%e5%b8%b8%e7%94%a8%e6%8a%80%e6%9c%af aria-label=æœ¬åœ°ç¼“å­˜å¸¸ç”¨æŠ€æœ¯>æœ¬åœ°ç¼“å­˜å¸¸ç”¨æŠ€æœ¯</a><ul><li><a href=#1-%e6%a0%b9%e6%8d%aehashmap%e8%87%aa%e5%ae%9a%e4%b9%89%e5%ae%9e%e7%8e%b0%e6%9c%ac%e5%9c%b0%e7%bc%93%e5%ad%98 aria-label="1. æ ¹æ®HashMapè‡ªå®šä¹‰å®ç°æœ¬åœ°ç¼“å­˜">1. æ ¹æ®HashMapè‡ªå®šä¹‰å®ç°æœ¬åœ°ç¼“å­˜</a></li><li><a href=#2-%e5%9f%ba%e4%ba%8eguava-cache%e5%ae%9e%e7%8e%b0%e6%9c%ac%e5%9c%b0%e7%bc%93%e5%ad%98 aria-label="2. åŸºäºGuava Cacheå®ç°æœ¬åœ°ç¼“å­˜">2. åŸºäºGuava Cacheå®ç°æœ¬åœ°ç¼“å­˜</a></li><li><a href=#3-caffeine aria-label="3. Caffeine">3. Caffeine</a></li><li><a href=#4-encache aria-label="4. Encache">4. Encache</a></li></ul></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=æ€»ç»“>æ€»ç»“</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h3 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h3><p>å¯¹ä¸€ä¸ªjavaåå°å¼€å‘è€…è€Œè¨€ï¼Œæåˆ°ç¼“å­˜ï¼Œç¬¬ä¸€ååº”å°±æ˜¯rediså’Œmemcacheã€‚åˆ©ç”¨è¿™ç±»ç¼“å­˜è¶³ä»¥è§£å†³å¤§å¤šæ•°çš„æ€§èƒ½é—®é¢˜äº†ï¼Œå¹¶ä¸”javaé’ˆå¯¹è¿™ä¸¤è€…ä¹Ÿéƒ½æœ‰éå¸¸æˆç†Ÿçš„apiå¯ä¾›ä½¿ç”¨ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿè¦çŸ¥é“ï¼Œè¿™ä¸¤ç§éƒ½å±äºremote cacheï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰ï¼Œåº”ç”¨çš„è¿›ç¨‹å’Œç¼“å­˜çš„è¿›ç¨‹é€šå¸¸åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä¸åŒè¿›ç¨‹ä¹‹é—´é€šè¿‡RPCæˆ–HTTPçš„æ–¹å¼é€šä¿¡ã€‚è¿™ç§ç¼“å­˜çš„ä¼˜ç‚¹æ˜¯ç¼“å­˜å’Œåº”ç”¨æœåŠ¡è§£è€¦ï¼Œæ”¯æŒå¤§æ•°æ®é‡çš„å­˜å‚¨ï¼Œç¼ºç‚¹æ˜¯æ•°æ®è¦ç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œæ€§èƒ½ä¸Šä¼šæœ‰ä¸€å®šæŸè€—ã€‚ä¸åˆ†å¸ƒå¼ç¼“å­˜å¯¹åº”çš„æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œç¼“å­˜çš„è¿›ç¨‹å’Œåº”ç”¨è¿›ç¨‹æ˜¯åŒä¸€ä¸ªï¼Œæ•°æ®çš„è¯»å†™éƒ½åœ¨ä¸€ä¸ªè¿›ç¨‹å†…å®Œæˆï¼Œè¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯æ²¡æœ‰ç½‘ç»œå¼€é”€ï¼Œè®¿é—®é€Ÿåº¦å¾ˆå¿«ã€‚ç¼ºç‚¹æ˜¯å—JVMå†…å­˜çš„é™åˆ¶ï¼Œä¸é€‚åˆå­˜æ”¾å¤§æ•°æ®ã€‚æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬ä¸»è¦ä¸»è¦è®¨è®ºJavaæœ¬åœ°ç¼“å­˜çš„çš„ä¸€äº›å¸¸ç”¨æ–¹æ¡ˆã€‚</p><h3 id=æœ¬åœ°ç¼“å­˜å¸¸ç”¨æŠ€æœ¯>æœ¬åœ°ç¼“å­˜å¸¸ç”¨æŠ€æœ¯<a hidden class=anchor aria-hidden=true href=#æœ¬åœ°ç¼“å­˜å¸¸ç”¨æŠ€æœ¯>#</a></h3><p>æœ¬åœ°ç¼“å­˜å’Œåº”ç”¨åŒå±äºä¸€ä¸ªè¿›ç¨‹ï¼Œä½¿ç”¨ä¸å½“ä¼šå½±å“æœåŠ¡ç¨³å®šæ€§ï¼Œæ‰€ä»¥é€šå¸¸éœ€è¦è€ƒè™‘æ›´å¤šçš„å› ç´ ï¼Œä¾‹å¦‚å®¹é‡é™åˆ¶ã€è¿‡æœŸç­–ç•¥ã€æ·˜æ±°ç­–ç•¥ã€è‡ªåŠ¨åˆ·æ–°ç­‰ã€‚å¸¸ç”¨çš„æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆæœ‰ï¼š</p><ul><li>æ ¹æ®HashMapè‡ªå®ç°æœ¬åœ°ç¼“å­˜</li><li>Guava Cache</li><li>Caffeine</li><li>Encache</li></ul><p>æ€»ä½“æ¥è¯´ï¼Œå¯¹äºæœ¬åœ°ç¼“å­˜çš„æ–¹æ¡ˆä¸­ï¼Œç¬”è€…æ¯”è¾ƒæ¨èCaffeineï¼Œæ€§èƒ½ä¸Šé¥é¥é¢†å…ˆã€‚è™½ç„¶EncacheåŠŸèƒ½æ›´ä¸ºä¸°å¯Œï¼Œç”šè‡³æä¾›äº†æŒä¹…åŒ–å’Œé›†ç¾¤çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™äº›åŠŸèƒ½å®Œå…¨å¯ä»¥ä¾é å…¶ä»–æ–¹å¼å®ç°ã€‚çœŸå®çš„ä¸šåŠ¡å·¥ç¨‹ä¸­ï¼Œå»ºè®®ä½¿ç”¨Caffeineä½œä¸ºæœ¬åœ°ç¼“å­˜ï¼Œå¦å¤–ä½¿ç”¨redisæˆ–è€…memcacheä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜ï¼Œæ„é€ å¤šçº§ç¼“å­˜ä½“ç³»ï¼Œä¿è¯æ€§èƒ½å’Œå¯é æ€§ã€‚ä¸‹é¢åˆ†åˆ«è¿›è¡Œä»‹ç»ï¼š</p><h4 id=1-æ ¹æ®hashmapè‡ªå®šä¹‰å®ç°æœ¬åœ°ç¼“å­˜>1. æ ¹æ®HashMapè‡ªå®šä¹‰å®ç°æœ¬åœ°ç¼“å­˜<a hidden class=anchor aria-hidden=true href=#1-æ ¹æ®hashmapè‡ªå®šä¹‰å®ç°æœ¬åœ°ç¼“å­˜>#</a></h4><p>ç¼“å­˜çš„æœ¬è´¨å°±æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„KVæ•°æ®ç»“æ„ï¼Œå¯¹åº”çš„å°±æ˜¯jdkä¸­çš„HashMapï¼Œä½†æ˜¯è¦å®ç°ç¼“å­˜ï¼Œè¿˜éœ€è¦è€ƒè™‘å¹¶å‘å®‰å…¨æ€§ã€å®¹é‡é™åˆ¶ç­‰ç­–ç•¥ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ç§åˆ©ç”¨LinkedHashMapå®ç°ç¼“å­˜çš„æ–¹å¼ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LRUCache</span> <span class=kd>extends</span> <span class=n>LinkedHashMap</span> <span class=o>{</span>     <span class=cm>/**      * å¯é‡å…¥è¯»å†™é”ï¼Œä¿è¯å¹¶å‘è¯»å†™å®‰å…¨æ€§      */</span>     <span class=kd>private</span> <span class=n>ReentrantReadWriteLock</span> <span class=n>readWriteLock</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ReentrantReadWriteLock</span><span class=o>();</span>     <span class=kd>private</span> <span class=n>Lock</span> <span class=n>readLock</span> <span class=o>=</span> <span class=n>readWriteLock</span><span class=o>.</span><span class=na>readLock</span><span class=o>();</span>     <span class=kd>private</span> <span class=n>Lock</span> <span class=n>writeLock</span> <span class=o>=</span> <span class=n>readWriteLock</span><span class=o>.</span><span class=na>writeLock</span><span class=o>();</span>     <span class=cm>/**      * ç¼“å­˜å¤§å°é™åˆ¶      */</span>     <span class=kd>private</span> <span class=kt>int</span> <span class=n>maxSize</span><span class=o>;</span>     <span class=kd>public</span> <span class=nf>LRUCache</span><span class=o>(</span><span class=kt>int</span> <span class=n>maxSize</span><span class=o>)</span> <span class=o>{</span>         <span class=kd>super</span><span class=o>(</span><span class=n>maxSize</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=mf>1.0f</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>         <span class=k>this</span><span class=o>.</span><span class=na>maxSize</span> <span class=o>=</span> <span class=n>maxSize</span><span class=o>;</span>     <span class=o>}</span>     <span class=nd>@Override</span>     <span class=kd>public</span> <span class=n>Object</span> <span class=nf>get</span><span class=o>(</span><span class=n>Object</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>         <span class=n>readLock</span><span class=o>.</span><span class=na>lock</span><span class=o>();</span>         <span class=k>try</span> <span class=o>{</span>             <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>key</span><span class=o>);</span>         <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>             <span class=n>readLock</span><span class=o>.</span><span class=na>unlock</span><span class=o>();</span>         <span class=o>}</span>     <span class=o>}</span>     <span class=nd>@Override</span>     <span class=kd>public</span> <span class=n>Object</span> <span class=nf>put</span><span class=o>(</span><span class=n>Object</span> <span class=n>key</span><span class=o>,</span> <span class=n>Object</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>         <span class=n>writeLock</span><span class=o>.</span><span class=na>lock</span><span class=o>();</span>         <span class=k>try</span> <span class=o>{</span>             <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>         <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>             <span class=n>writeLock</span><span class=o>.</span><span class=na>unlock</span><span class=o>();</span>         <span class=o>}</span>     <span class=o>}</span>     <span class=nd>@Override</span>     <span class=kd>protected</span> <span class=kt>boolean</span> <span class=nf>removeEldestEntry</span><span class=o>(</span><span class=n>Map</span><span class=o>.</span><span class=na>Entry</span> <span class=n>eldest</span><span class=o>)</span> <span class=o>{</span>         <span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>&gt;</span> <span class=n>maxSize</span><span class=o>;</span>     <span class=o>}</span> <span class=o>}</span>
</span></span></code></pre></div><p>å¤åˆ¶ä»£ç LinkedHashMapç»´æŒäº†ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œç”¨æ¥å­˜å‚¨èŠ‚ç‚¹çš„æ’å…¥é¡ºåºæˆ–è€…è®¿é—®é¡ºåºï¼ˆäºŒé€‰ä¸€ï¼‰ï¼Œå¹¶ä¸”å†…éƒ¨å°è£…äº†ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œåªéœ€è¦è¦†ç›–removeEldestEntryæ–¹æ³•ï¼Œä¾¿å¯ä»¥å®ç°ç¼“å­˜çš„LRUæ·˜æ±°ç­–ç•¥ã€‚æ­¤å¤–æˆ‘ä»¬åˆ©ç”¨è¯»å†™é”ï¼Œä¿éšœç¼“å­˜çš„å¹¶å‘å®‰å…¨æ€§ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç¤ºä¾‹å¹¶ä¸æ”¯æŒè¿‡æœŸæ—¶é—´æ·˜æ±°çš„ç­–ç•¥ã€‚è‡ªå®ç°ç¼“å­˜çš„æ–¹å¼ï¼Œä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œä¸éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…ï¼Œæ¯”è¾ƒé€‚åˆä¸€äº›ç®€å•çš„ä¸šåŠ¡åœºæ™¯ã€‚ç¼ºç‚¹æ˜¯å¦‚æœéœ€è¦æ›´å¤šçš„ç‰¹æ€§ï¼Œéœ€è¦å®šåˆ¶åŒ–å¼€å‘ï¼Œæˆæœ¬ä¼šæ¯”è¾ƒé«˜ï¼Œå¹¶ä¸”ç¨³å®šæ€§å’Œå¯é æ€§ä¹Ÿéš¾ä»¥ä¿éšœã€‚å¯¹äºæ¯”è¾ƒå¤æ‚çš„åœºæ™¯ï¼Œå»ºè®®ä½¿ç”¨æ¯”è¾ƒç¨³å®šçš„å¼€æºå·¥å…·ã€‚</p><h4 id=2-åŸºäºguava-cacheå®ç°æœ¬åœ°ç¼“å­˜>2. åŸºäºGuava Cacheå®ç°æœ¬åœ°ç¼“å­˜<a hidden class=anchor aria-hidden=true href=#2-åŸºäºguava-cacheå®ç°æœ¬åœ°ç¼“å­˜>#</a></h4><p>Guavaæ˜¯Googleå›¢é˜Ÿå¼€æºçš„ä¸€æ¬¾ Java æ ¸å¿ƒå¢å¼ºåº“ï¼ŒåŒ…å«é›†åˆã€å¹¶å‘åŸè¯­ã€ç¼“å­˜ã€IOã€åå°„ç­‰å·¥å…·ç®±ï¼Œæ€§èƒ½å’Œç¨³å®šæ€§ä¸Šéƒ½æœ‰ä¿éšœï¼Œåº”ç”¨ååˆ†å¹¿æ³›ã€‚Guava Cacheæ”¯æŒå¾ˆå¤šç‰¹æ€§ï¼š</p><ul><li>æ”¯æŒæœ€å¤§å®¹é‡é™åˆ¶</li><li>æ”¯æŒä¸¤ç§è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼ˆæ’å…¥æ—¶é—´å’Œè®¿é—®æ—¶é—´ï¼‰</li><li>æ”¯æŒç®€å•çš„ç»Ÿè®¡åŠŸèƒ½</li><li>åŸºäºLRUç®—æ³•å®ç°</li></ul><p>Guava Cacheçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥mavenåŒ…ï¼š com.google.guava guava 18.0 å¤åˆ¶ä»£ç ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼špublic class GuavaCacheTest { public static void main(String[] args) throws Exception { //åˆ›å»ºguava cache Cache&lt;String, String> loadingCache = CacheBuilder.newBuilder() //cacheçš„åˆå§‹å®¹é‡ .initialCapacity(5) //cacheæœ€å¤§ç¼“å­˜æ•° .maximumSize(10) //è®¾ç½®å†™ç¼“å­˜ånç§’é’Ÿè¿‡æœŸ .expireAfterWrite(17, TimeUnit.SECONDS) //è®¾ç½®è¯»å†™ç¼“å­˜ånç§’é’Ÿè¿‡æœŸ,å®é™…å¾ˆå°‘ç”¨åˆ°,ç±»ä¼¼äºexpireAfterWrite //.expireAfterAccess(17, TimeUnit.SECONDS) .build(); String key = &ldquo;key&rdquo;; // å¾€ç¼“å­˜å†™æ•°æ® loadingCache.put(key, &ldquo;v&rdquo;); // è·å–valueçš„å€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œè°ƒç”¨collableæ–¹æ³•è·å–valueå€¼åŠ è½½åˆ°keyä¸­å†è¿”å› String value = loadingCache.get(key, new Callable() { @Override public String call() throws Exception { return getValueFromDB(key); } }); // åˆ é™¤key loadingCache.invalidate(key); } private static String getValueFromDB(String key) { return &ldquo;v&rdquo;; } } å¤åˆ¶ä»£ç æ€»ä½“æ¥è¯´ï¼ŒGuava Cacheæ˜¯ä¸€æ¬¾ååˆ†ä¼˜å¼‚çš„ç¼“å­˜å·¥å…·ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œçº¿ç¨‹å®‰å…¨ï¼Œè¶³ä»¥æ»¡è¶³å·¥ç¨‹åŒ–ä½¿ç”¨ï¼Œä»¥ä¸Šä»£ç åªä»‹ç»äº†ä¸€èˆ¬çš„ç”¨æ³•ï¼Œå®é™…ä¸Šspringbootå¯¹guavaä¹Ÿæœ‰æ”¯æŒï¼Œåˆ©ç”¨é…ç½®æ–‡ä»¶æˆ–è€…æ³¨è§£å¯ä»¥è½»æ¾é›†æˆåˆ°ä»£ç ä¸­ã€‚</p><h4 id=3-caffeine>3. Caffeine<a hidden class=anchor aria-hidden=true href=#3-caffeine>#</a></h4><p>Caffeineæ˜¯åŸºäºjava8å®ç°çš„æ–°ä¸€ä»£ç¼“å­˜å·¥å…·ï¼Œç¼“å­˜æ€§èƒ½æ¥è¿‘ç†è®ºæœ€ä¼˜ã€‚å¯ä»¥çœ‹ä½œæ˜¯Guava Cacheçš„å¢å¼ºç‰ˆï¼ŒåŠŸèƒ½ä¸Šä¸¤è€…ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯Caffeineé‡‡ç”¨äº†ä¸€ç§ç»“åˆLRUã€LFUä¼˜ç‚¹çš„ç®—æ³•ï¼šW-TinyLFUï¼Œåœ¨æ€§èƒ½ä¸Šæœ‰æ˜æ˜¾çš„ä¼˜è¶Šæ€§ã€‚Caffeineçš„ä½¿ç”¨ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥mavenåŒ…ï¼š com.github.ben-manes.caffeine caffeine 2.5.5 å¤åˆ¶ä»£ç ä½¿ç”¨ä¸Šå’ŒGuava CacheåŸºæœ¬ç±»ä¼¼ï¼špublic class CaffeineCacheTest { public static void main(String[] args) throws Exception { //åˆ›å»ºguava cache Cache&lt;String, String> loadingCache = Caffeine.newBuilder() //cacheçš„åˆå§‹å®¹é‡ .initialCapacity(5) //cacheæœ€å¤§ç¼“å­˜æ•° .maximumSize(10) //è®¾ç½®å†™ç¼“å­˜ånç§’é’Ÿè¿‡æœŸ .expireAfterWrite(17, TimeUnit.SECONDS) //è®¾ç½®è¯»å†™ç¼“å­˜ånç§’é’Ÿè¿‡æœŸ,å®é™…å¾ˆå°‘ç”¨åˆ°,ç±»ä¼¼äºexpireAfterWrite //.expireAfterAccess(17, TimeUnit.SECONDS) .build(); String key = &ldquo;key&rdquo;; // å¾€ç¼“å­˜å†™æ•°æ® loadingCache.put(key, &ldquo;v&rdquo;); // è·å–valueçš„å€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œè·å–valueåå†è¿”å› String value = loadingCache.get(key, CaffeineCacheTest::getValueFromDB); // åˆ é™¤key loadingCache.invalidate(key); } private static String getValueFromDB(String key) { return &ldquo;v&rdquo;; } } å¤åˆ¶ä»£ç ç›¸æ¯”Guava Cacheæ¥è¯´ï¼ŒCaffeineæ— è®ºä»åŠŸèƒ½ä¸Šå’Œæ€§èƒ½ä¸Šéƒ½æœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚åŒæ—¶ä¸¤è€…çš„APIç±»ä¼¼ï¼Œä½¿ç”¨Guava Cacheçš„ä»£ç å¾ˆå®¹æ˜“å¯ä»¥åˆ‡æ¢åˆ°Caffeineï¼ŒèŠ‚çœè¿ç§»æˆæœ¬ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSpringFramework5.0ï¼ˆSpringBoot2.0ï¼‰åŒæ ·æ”¾å¼ƒäº†Guava Cacheçš„æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆï¼Œè½¬è€Œä½¿ç”¨Caffeineã€‚</p><h4 id=4-encache>4. Encache<a hidden class=anchor aria-hidden=true href=#4-encache>#</a></h4><p>Encacheæ˜¯ä¸€ä¸ªçº¯Javaçš„è¿›ç¨‹å†…ç¼“å­˜æ¡†æ¶ï¼Œå…·æœ‰å¿«é€Ÿã€ç²¾å¹²ç­‰ç‰¹ç‚¹ï¼Œæ˜¯Hibernateä¸­é»˜è®¤çš„CacheProviderã€‚åŒCaffeineå’ŒGuava Cacheç›¸æ¯”ï¼ŒEncacheçš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œæ‰©å±•æ€§æ›´å¼ºï¼š</p><ul><li>æ”¯æŒå¤šç§ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼ŒåŒ…æ‹¬LRUã€LFUå’ŒFIFO</li><li>ç¼“å­˜æ”¯æŒå †å†…å­˜å‚¨ã€å †å¤–å­˜å‚¨ã€ç£ç›˜å­˜å‚¨ï¼ˆæ”¯æŒæŒä¹…åŒ–ï¼‰ä¸‰ç§</li><li>æ”¯æŒå¤šç§é›†ç¾¤æ–¹æ¡ˆï¼Œè§£å†³æ•°æ®å…±äº«é—®é¢˜</li></ul><p>Encacheçš„ä½¿ç”¨ï¼Œé¦–å…ˆéœ€è¦å¯¼å…¥mavenåŒ…ï¼š org.ehcache ehcache 3.8.0 å¤åˆ¶ä»£ç ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ¡ˆä¾‹ï¼špublic class EncacheTest { public static void main(String[] args) throws Exception { // å£°æ˜ä¸€ä¸ªcacheBuilder CacheManager cacheManager = CacheManagerBuilder.newCacheManagerBuilder() .withCache(&ldquo;encacheInstance&rdquo;, CacheConfigurationBuilder //å£°æ˜ä¸€ä¸ªå®¹é‡ä¸º20çš„å †å†…ç¼“å­˜ .newCacheConfigurationBuilder(String.class,String.class, ResourcePoolsBuilder.heap(20))) .build(true); // è·å–Cacheå®ä¾‹ Cache&lt;String,String> myCache = cacheManager.getCache(&ldquo;encacheInstance&rdquo;, String.class, String.class); // å†™ç¼“å­˜ myCache.put(&ldquo;key&rdquo;,&ldquo;v&rdquo;); // è¯»ç¼“å­˜ String value = myCache.get(&ldquo;key&rdquo;); // ç§»é™¤æ¢ç²— cacheManager.removeCache(&ldquo;myCache&rdquo;); cacheManager.close(); } } å¤åˆ¶ä»£ç </p><h3 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h3><ul><li>ä»æ˜“ç”¨æ€§è§’åº¦ï¼ŒGuava Cacheã€Caffeineå’ŒEncacheéƒ½æœ‰ååˆ†æˆç†Ÿçš„æ¥å…¥æ–¹æ¡ˆï¼Œä½¿ç”¨ç®€å•ã€‚</li><li>ä»åŠŸèƒ½æ€§è§’åº¦ï¼ŒGuava Cacheå’ŒCaffeineåŠŸèƒ½ç±»ä¼¼ï¼Œéƒ½æ˜¯åªæ”¯æŒå †å†…ç¼“å­˜ï¼ŒEncacheç›¸æ¯”åŠŸèƒ½æ›´ä¸ºä¸°å¯Œ</li><li>ä»æ€§èƒ½ä¸Šè¿›è¡Œæ¯”è¾ƒï¼ŒCaffeineæœ€ä¼˜ã€GuavaCacheæ¬¡ä¹‹ï¼ŒEncacheæœ€å·®(ä¸‹å›¾æ˜¯ä¸‰è€…çš„æ€§èƒ½å¯¹æ¯”ç»“æœï¼‰</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://luolin1024.github.io/tags/java/%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98/>Java/æœ¬åœ°ç¼“å­˜</a></li><li><a href=https://luolin1024.github.io/tags/%E7%BC%93%E5%AD%98/>ç¼“å­˜</a></li></ul><nav class=paginav><a class=prev href=https://luolin1024.github.io/blog_prepublish/%E6%8A%80%E6%9C%AF%E6%8F%90%E5%8D%87/java/java%E6%97%A5%E6%9C%9F%E5%A4%84%E7%90%86/><span class=title>Â« Prev</span><br><span>Javaæ—¥æœŸå¤„ç†</span></a>
<a class=next href=https://luolin1024.github.io/blog_prepublish/%E6%8A%80%E6%9C%AF%E6%8F%90%E5%8D%87/java/java%E6%9E%9A%E4%B8%BE/><span class=title>Next Â»</span><br><span>Javaæšä¸¾</span></a></nav><div class=related-posts><h2>ç›¸å…³æ–‡ç« </h2><ul><li>Â· <a href=/blog_prepublish/pre-publish/redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81setnx/>rediså®ç°åˆ†å¸ƒå¼é”â€”â€”setnx</a></li><li>Â· <a href=/blog_prepublish/%E6%8A%80%E6%9C%AF%E6%8F%90%E5%8D%87/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3/>ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜æ€ä¹ˆè§£å†³</a></li><li>Â· <a href=/2024/02/cache-penetration-and-cache-breakdown-and-cache-avalanche-and-the-solution/>ç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿å’Œç¼“å­˜é›ªå´©çš„åŒºåˆ«ä»¥åŠè§£å†³æ–¹æ¡ˆ</a></li></ul></div></footer><link rel=stylesheet href=https://unpkg.com/@waline/client@v2/dist/waline.css><div id=waline></div><script type=module>
    import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
    const locale = {
        nick: 'æ˜µç§°',
        nickError: 'è¯·å¡«å†™æ˜µç§°',
        mail: 'é‚®ç®±',
        mailError: 'è¯·å¡«å†™æ­£ç¡®çš„é‚®ä»¶åœ°å€',
        link: 'ç½‘å€',
        optional: 'å¯é€‰',
        placeholder: 'ä»…å¡«å†™æ˜µç§°å³å¯å‘è¡¨å›å¤ã€‚\nå¡«å†™é‚®ç®±å¯æ”¶åˆ°å›å¤æé†’ã€‚\nè¯„è®ºåŒºæ”¯æŒ Markdown è¯­æ³•åŠé¢„è§ˆã€‚\n',
        sofa: 'æ¥å‘è¯„è®ºå§~',
        submit: 'æäº¤',
        like: 'å–œæ¬¢',
        cancelLike: 'å–æ¶ˆå–œæ¬¢',
        reply: 'å›å¤',
        cancelReply: 'å–æ¶ˆå›å¤',
        comment: 'è¯„è®º',
        refresh: 'åˆ·æ–°',
        more: 'åŠ è½½æ›´å¤š...',
        preview: 'é¢„è§ˆ',
        emoji: 'è¡¨æƒ…',
        uploadImage: 'ä¸Šä¼ å›¾ç‰‡',
        seconds: 'ç§’å‰',
        minutes: 'åˆ†é’Ÿå‰',
        hours: 'å°æ—¶å‰',
        days: 'å¤©å‰',
        now: 'åˆšåˆš',
        uploading: 'æ­£åœ¨ä¸Šä¼ ',
        login: 'ç®¡ç†',
        logout: 'é€€å‡º',
        admin: 'åšä¸»',
        sticky: 'ç½®é¡¶',
        word: 'å­—',
        wordHint: 'è¯„è®ºå­—æ•°åº”åœ¨ $0 åˆ° $1 å­—ä¹‹é—´ï¼\nå½“å‰å­—æ•°ï¼š$2',
        anonymous: 'åŒ¿å',
        level0: 'æ½œæ°´',
        level1: 'å†’æ³¡',
        level2: 'åæ§½',
        level3: 'æ´»è·ƒ',
        level4: 'è¯ç—¨',
        level5: 'ä¼ è¯´',
        gif: 'è¡¨æƒ…åŒ…',
        gifSearchPlaceholder: 'æœç´¢è¡¨æƒ…åŒ…',
        profile: 'ä¸ªäººèµ„æ–™',
        approved: 'é€šè¿‡',
        waiting: 'å¾…å®¡æ ¸',
        spam: 'åƒåœ¾',
        unsticky: 'å–æ¶ˆç½®é¡¶',
        oldest: 'æŒ‰å€’åº',
        latest: 'æŒ‰æ­£åº',
        hottest: 'æŒ‰çƒ­åº¦',
        reactionTitle: 'ä½ è®¤ä¸ºè¿™ç¯‡æ–‡ç« æ€ä¹ˆæ ·ï¼Ÿ',
    };
    init({
        
        el: '#waline',
        serverURL: 'https://blogcomments.luolin.online',
        locale,
        emoji: false,     
        search: false,    
        reaction: false,  
        requiredMeta: ['nick'],
        pageSize: 10,
        imageUploader: false,
        copyright: true,
        pageview: true,
        like: false,
    });
</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://luolin1024.github.io>luolin1024</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><div>æœ¬ç«™æ€»è®¿é—®é‡ <span id=umami_value_site_pv></span> æ¬¡
æœ¬ç«™æ€»è®¿å®¢æ•° <span id=umami_value_site_uv></span> äºº
å½“å‰åœ¨çº¿è®¿å®¢ <span id=umami_value_active_uv></span> äºº</div><a href="https://icp.gov.moe/?keyword=20248618" target=_blank>èŒICPå¤‡20248618å·</a></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>